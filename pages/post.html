<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Release Details | music.date.with.sophie</title>
    <link rel="stylesheet" href="../style/style.css" />
    <script type="module" src="../script/discogsAPI.js"></script>
  </head>
  <body>
    <nav class="top-bar top-bar--color">
      <div class="navChild">
        <div class="img_links_wrapper">
          <a href="../index.html">
            <img
              src="https://picsum.photos/70/50"
              alt="Website logo"
              class="navChild__image"
            />
          </a>
          <div class="navChild__links">
            <a href="../index.html" class="top-bar_link">Home</a>
            <!-- Update these links as needed -->
            <a href="../index.html" class="top-bar_link">News</a>
            <a href="../index.html" class="top-bar_link">Releases</a>
            <a href="../index.html" class="top-bar_link">Reviews</a>
          </div>
        </div>
        <div class="navChild" id="searchBar">
          <input type="search" placeholder="Search releases..." />
          <button>Search</button>
        </div>
      </div>
    </nav>

    <main class="release-details max-width">
      <!-- Loading state -->
      <div id="loading" class="text-align-center">
        Loading release details...
      </div>

      <!-- Error state -->
      <div
        id="error"
        class="text-align-center"
        style="display: none; color: red"
      >
        Error loading release details.
      </div>

      <!-- Release content (hidden until loaded) -->
      <div id="releaseContent" style="display: none">
        <div class="release-header">
          <img id="releaseCover" alt="Album cover" class="release-cover" />
          <div class="release-meta">
            <h1 id="releaseTitle"></h1>
            <h2 id="releaseArtist"></h2>
            <p id="releaseYear"></p>
            <p id="releaseGenre"></p>
            <p id="releaseLabel"></p>
          </div>
        </div>

        <section class="tracklist-section">
          <h3>Tracklist</h3>
          <ol id="tracklist"></ol>
        </section>

        <section class="extra-info">
          <div class="info-box">
            <h4>Country</h4>
            <p id="releaseCountry"></p>
          </div>
          <div class="info-box">
            <h4>Format</h4>
            <p id="releaseFormat"></p>
          </div>
          <div class="info-box">
            <h4>Discogs Page</h4>
            <a id="discogsLink" target="_blank">View on Discogs</a>
          </div>
        </section>
      </div>
    </main>

    <script type="module">
      import { fetchReleaseDetails } from "../script/discogsAPI.js";

      // Get release ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const releaseId = urlParams.get("id");

      // Elements
      const loadingEl = document.getElementById("loading");
      const errorEl = document.getElementById("error");
      const contentEl = document.getElementById("releaseContent");

      if (releaseId) {
        fetchReleaseDetails(releaseId)
          .then((data) => {
            if (data) {
              populateReleaseData(data);
              contentEl.style.display = "block";
              loadingEl.style.display = "none";
            } else {
              showError();
            }
          })
          .catch(() => showError());
      } else {
        showError("No release ID specified");
      }

      function populateReleaseData(release) {
        // Basic info
        document.getElementById("releaseTitle").textContent = release.title;
        document.getElementById("releaseArtist").textContent =
          release.artists?.map((a) => a.name).join(", ") || "Unknown artist";
        document.getElementById("releaseYear").textContent =
          release.year || "Unknown year";
        document.getElementById("releaseGenre").textContent =
          release.genres?.join(", ") || "Unknown genre";
        document.getElementById("releaseLabel").textContent =
          release.labels?.[0]?.name || "Unknown label";
        document.getElementById("releaseCountry").textContent =
          release.country || "Unknown";
        document.getElementById("releaseFormat").textContent =
          release.formats
            ?.map((f) => `${f.name}${f.qty > 1 ? ` (${f.qty}x)` : ""}`)
            .join(", ") || "Unknown";

        // Cover image
        const coverImg = document.getElementById("releaseCover");
        if (release.images?.[0]?.uri) {
          coverImg.src = release.images[0].uri;
        } else {
          coverImg.src = "https://via.placeholder.com/400x400?text=No+Image";
        }

        // Tracklist
        const tracklistEl = document.getElementById("tracklist");
        if (release.tracklist?.length > 0) {
          tracklistEl.innerHTML = release.tracklist
            .map(
              (track) =>
                `<li>${track.position} - ${track.title} ${
                  track.duration ? `(${track.duration})` : ""
                }</li>`
            )
            .join("");
        } else {
          tracklistEl.innerHTML = "<li>No tracklist available</li>";
        }

        // Discogs link
        const discogsLink = document.getElementById("discogsLink");
        if (release.uri) {
          discogsLink.href = release.uri;
        } else {
          discogsLink.style.display = "none";
        }
      }

      function showError(message) {
        loadingEl.style.display = "none";
        errorEl.style.display = "block";
        if (message) errorEl.textContent = message;
      }
    </script>
  </body>
</html>
